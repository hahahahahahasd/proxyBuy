<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <!-- 解决适配问题的关键 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>顾客点餐</title>
  <!-- 引入 Vant 样式 -->
  <link rel="stylesheet" href="https://unpkg.com/vant@4/lib/index.css" />
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background-color: #f7f8fa;
    }

    #app {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .content-wrap {
      flex: 1;
      display: flex;
      overflow: hidden;
      /* 关键：让内部元素自己滚动，而不是整个区域滚动 */
    }

    .sidebar-container {
      width: 80px;
      height: 100%;
      overflow-y: auto;
    }

    .menu-container {
      flex: 1;
      height: 100%;
      overflow-y: auto;
      padding: 0 10px;
    }

    .van-card {
      margin-bottom: 10px;
      border-radius: 8px;
    }

    .van-card__price {
      color: #ee0a24;
    }

    .category-title {
      margin: 16px 0 8px 16px;
      font-size: 14px;
      color: #323233;
      font-weight: 500;
    }
  </style>
</head>

<body>
  <div id="app">
    <!-- 顶部导航栏 -->
    <van-nav-bar title="在线点餐">
      <template #right>
        <div @click="onAddressClick" style="display: flex; align-items: center; cursor: pointer;">
          <van-icon name="location-o" size="18" />
          <span style="margin-left: 4px;">{{ selectedStore.name }}</span>
        </div>
      </template>
    </van-nav-bar>

    <!-- 主要内容区域 -->
    <div class="content-wrap">
      <!-- 侧边分类导航 -->
      <div class="sidebar-container">
        <van-sidebar v-model="activeCategory" @change="onCategoryChange">
          <van-sidebar-item v-for="category in categories" :title="category.name" :key="category.id" />
        </van-sidebar>
      </div>

      <!-- 菜品列表 -->
      <div class="menu-container" ref="menuContainer">
        <div v-for="category in categories" :key="category.id" :ref="'category-' + category.id">
          <h3 class="category-title">{{ category.name }}</h3>
          <van-card v-for="item in category.items" :key="item.id" :price="item.price.toFixed(2)"
            :desc="item.description" :title="item.name" thumb="https://img.yzcdn.cn/vant/ipad.jpeg">
            <template #footer>
              <van-stepper v-model="cart[item.id]" @change="updateCart(item, $event)" />
            </template>
          </van-card>
        </div>
      </div>
    </div>

    <!-- 底部购物车 -->
    <van-submit-bar :price="totalPrice * 100" button-text="去结算" :safe-area-inset-bottom="true" @submit="onSubmit"
      :badge="totalItems" v-show="totalItems > 0">
      <van-icon name="cart-o" size="24" @click="showCart = true" style="margin-left: 10px;" />
    </van-submit-bar>

    <!-- 购物车弹出层 -->
    <van-popup v-model="showCart" position="bottom" :style="{ height: '60%' }" round>
      <van-nav-bar title="购物车">
        <template #right>
          <van-button type="text" @click="clearCart">清空</van-button>
        </template>
      </van-nav-bar>
      <div style="padding: 16px;">
        <div v-for="item in cartItems" :key="item.id" style="display: flex; align-items: center; margin-bottom: 10px;">
          <span style="flex: 1;">{{ item.name }}</span>
          <van-stepper v-model="cart[item.id]" @change="updateCart(item, $event)" />
        </div>
      </div>
    </van-popup>

    <!-- 地址选择弹出层 -->
    <van-popup v-model="showAddressPopup" position="bottom" :style="{ height: '80%' }" round>
      <van-nav-bar title="选择门店" />
      <van-search v-model="searchKeyword" placeholder="请输入门店名称" />
      <van-cell-group>
        <van-cell v-for="store in filteredStoreList" :key="store.id" @click="onSelectStore(store)">
          <template #title>
            <div style="font-weight: bold;">{{ store.name }}</div>
          </template>
          <template #label>
            <div>{{ store.address }}</div>
            <div>距离您 {{ store.distance }}</div>
          </template>
        </van-cell>
      </van-cell-group>
    </van-popup>

  </div>

  <!-- 引入 Vue 和 Vant 的 JS 文件 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/vant@4/lib/vant.min.js"></script>
  <!-- 引入我们自己的 JS 文件 -->
  <script src="./customer-v2.js"></script>
</body>

</html>